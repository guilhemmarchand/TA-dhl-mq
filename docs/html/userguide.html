

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>User guide &mdash; TA-dhl-mq 1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshoot" href="troubleshoot.html" />
    <link rel="prev" title="Role Based Access Control (RBAC)" href="rbac.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> TA-dhl-mq
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="compatibility.html">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment and base configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">MQ managers Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="high_availability.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="rbac.html">Role Based Access Control (RBAC)</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">User guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#submitting-messages-to-ibm-mq-series-from-splunk">Submitting messages to IBM MQ Series from Splunk</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sending-messages-to-ibm-mqseries-with-the-putmqrelay-command">Sending messages to IBM MQSeries with the putmqrelay command</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#managing-mq-submission-batches">Managing MQ submission batches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#batches-statuses">Batches statuses</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validating-a-batch-pending-from-approval">Validating a batch pending from approval</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-a-batch-pending-from-processing">Managing a batch pending from processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-a-batch-pending-in-temporary-failure">Managing a batch pending in temporary failure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-a-batch-pending-in-permanent-failure">Managing a batch pending in permanent failure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-a-successful-batch">Managing a successful batch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#verifying-the-status-of-the-mq-submission">Verifying the status of the MQ submission</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mq-overview-dashboard">MQ Overview dashboard</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot.html">Troubleshoot</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development and build process</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TA-dhl-mq</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>User guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/userguide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<h1>User guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submitting-messages-to-ibm-mq-series-from-splunk">
<h2>Submitting messages to IBM MQ Series from Splunk<a class="headerlink" href="#submitting-messages-to-ibm-mq-series-from-splunk" title="Permalink to this headline">¶</a></h2>
<p><strong>Using the Technical Add-on for IBM MQ-Series developed for DHL allows you submit any message to IBM MQ-Series resulting from a Splunk query, using the following summarised cycle:</strong></p>
<ul class="simple">
<li><p>You run a Splunk search, which generates any number of results containing the message payloads to be sent as well as their identifiers (message ID)</p></li>
<li><p>Additional information are defined at search time, such as the destination Queue manager and the Queue</p></li>
<li><p>A custom command is called to interract and submit these messages to IBM MQ as part of a <code class="docutils literal notranslate"><span class="pre">batch</span></code></p></li>
<li><p>The batch is submitted as pending from approval</p></li>
<li><p>An approver receives a notification and approves your demand eventually, the approver can as well decide to refuse the batch and cancel its submission</p></li>
<li><p>After a couple of minutes, the batch is taken into account and messages start to be publishing by the Splunk Heavy Forwarders</p></li>
<li><p>Depending on the message nature (single line versus multiline) and the volume, the batch sent can take a few minutes to be full processed, or more</p></li>
</ul>
<div class="section" id="sending-messages-to-ibm-mqseries-with-the-putmqrelay-command">
<h3>Sending messages to IBM MQSeries with the putmqrelay command<a class="headerlink" href="#sending-messages-to-ibm-mqseries-with-the-putmqrelay-command" title="Permalink to this headline">¶</a></h3>
<p><strong>To send messages effectively, you will use a custom command named ``putmqrelay`` which requires the following arguments:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">field_message_id</span></code>: the name of the Splunk field containing the message identifiers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field_message</span></code>: the name of the Splunk field containing the message payloads</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field_appname</span></code>: the name of the Splunk field containing the application value, this is a string value which identifies the application</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field_region</span></code>: the name of the Splunk field containing the region value, this is a string value which idenfities the region for these messages</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field_manager</span></code>: the name of the Splunk field IBM MQ Queue manager, which needs to be defined on the Splunk Search Heads and the consumers for this application/region</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field_queue</span></code>: the name of the Splunk field containing the IBM MQ Queue destination for the messages</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dedup</span></code>: (true/false) optional dedup at the command level which ensures messages being sent are unique, this can be handled on the upstream search level too</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">comment</span></code>:  optional comment for the submission, this comment will be logged at different levels and made available for the approver to review</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_batchsize</span></code>: optional maximal amount of messages per batch, defaults to 10000 messages, when the limit is reached, one or more additional batches are created to accomodate with the query</p></li>
</ul>
<p>When the command is called, it will render a summary of the request with the following information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">action</span></code>: (success/failure) the result of the operation submit request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code>: a human reable message describing the result of the operation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">results_count</span></code>: how many messages were requested to be sent by the upstream search</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">processed_count</span></code>: how many messages the command handled</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kvstore_count</span></code>: how many messages where generated in the Splunk remote KVstore</p></li>
</ul>
<p>A simple example of sending a message to MQ:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">makeresults</span>
<span class="o">|</span> <span class="nb">eval</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;This is a test demo payload&quot;</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s2">&quot;DMG&quot;</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="s2">&quot;LAB&quot;</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="s2">&quot;QM1&quot;</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="s2">&quot;DEV.QUEUE.1&quot;</span><span class="p">,</span> <span class="n">MsgId</span><span class="o">=</span><span class="n">md5</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="o">|</span> <span class="n">putmqrelay</span> <span class="n">field_message_id</span><span class="o">=</span><span class="s2">&quot;MsgId&quot;</span> <span class="n">field_message</span><span class="o">=</span><span class="s2">&quot;message&quot;</span> <span class="n">field_appname</span><span class="o">=</span><span class="s2">&quot;appname&quot;</span> <span class="n">field_manager</span><span class="o">=</span><span class="s2">&quot;manager&quot;</span> <span class="n">field_queue</span><span class="o">=</span><span class="s2">&quot;queue&quot;</span> <span class="n">field_region</span><span class="o">=</span><span class="s2">&quot;region&quot;</span> <span class="n">dedup</span><span class="o">=</span><span class="s2">&quot;False&quot;</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Demo message&quot;</span>
</pre></div>
</div>
<p>Which results in:</p>
<a class="reference internal image-reference" href="_images/putmqrelay1.png"><img alt="putmqrelay1.png" class="align-center" src="_images/putmqrelay1.png" style="width: 1200px;" /></a>
<p>Sending a real batch of messages would look like:</p>
<a class="reference internal image-reference" href="_images/putmqrelay2.png"><img alt="putmqrelay2.png" class="align-center" src="_images/putmqrelay2.png" style="width: 1200px;" /></a>
<p>At this stage, a batch has been generated and is pending from approval. (see the next section)</p>
</div>
</div>
<div class="section" id="managing-mq-submission-batches">
<h2>Managing MQ submission batches<a class="headerlink" href="#managing-mq-submission-batches" title="Permalink to this headline">¶</a></h2>
<p><strong>The user interface MQ Manage Batches is designed to allow users to interract with the life cycle of the batches:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches1.png"><img alt="manage_batches1.png" class="align-center" src="_images/manage_batches1.png" style="width: 1200px;" /></a>
<div class="section" id="batches-statuses">
<h3>Batches statuses<a class="headerlink" href="#batches-statuses" title="Permalink to this headline">¶</a></h3>
<p><strong>A single batch can appear in different states:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pending_validation</span></code>: the batch was sumitted and is pending from approval by an approver member of the application role</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pending_processing</span></code>: the batch was approved already, and is pending from being processed by the application</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">temporary_failure</span></code>: the batch was approved and attempted once or more times, but has currently failed to be processed successfully</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">permanent_failure</span></code>: the batch has reached the maximal amount of attempts, and is now permanently failed, it will not be processed again</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">succesful</span></code>: the batch was processed successfully</p></li>
</ul>
</div>
<div class="section" id="validating-a-batch-pending-from-approval">
<h3>Validating a batch pending from approval<a class="headerlink" href="#validating-a-batch-pending-from-approval" title="Permalink to this headline">¶</a></h3>
<p><strong>A batch that is pending from approval can be approved by relevant users depending on their Splunk role membership:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches2.png"><img alt="manage_batches2.png" class="align-center" src="_images/manage_batches2.png" style="width: 1200px;" /></a>
<a class="reference internal image-reference" href="_images/manage_batches3.png"><img alt="manage_batches3.png" class="align-center" src="_images/manage_batches3.png" style="width: 1200px;" /></a>
<p><strong>A note can be added by the approver, this information is added to:</strong></p>
<ul class="simple">
<li><p>The different log files technically invovled in the process, and indexed in Splunk automatically</p></li>
<li><p>An history KVstore collection that retains the validation history for easy auditing purposes</p></li>
</ul>
<p><em>Log files:</em></p>
<ul class="simple">
<li><p>See the report: “DHL MQ Logs - managebatch logs (batch validation by approvers)”</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(`idx_mq`) sourcetype=&quot;mq:actions:mq_publish_message:managebatch&quot;
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/manage_batches4.png"><img alt="manage_batches4.png" class="align-center" src="_images/manage_batches4.png" style="width: 1200px;" /></a>
<p><em>History approval KVstore collection:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">inputlookup</span> <span class="n">mq_publish_batch_history</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span> <span class="n">ctime</span> <span class="o">|</span> <span class="nb">eval</span> <span class="n">ctime</span><span class="o">=</span><span class="n">strftime</span><span class="p">(</span><span class="n">ctime</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%c</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Shortcut access:</p>
<a class="reference internal image-reference" href="_images/manage_batches5.png"><img alt="manage_batches5.png" class="align-center" src="_images/manage_batches5.png" style="width: 1200px;" /></a>
</div>
<div class="section" id="managing-a-batch-pending-from-processing">
<h3>Managing a batch pending from processing<a class="headerlink" href="#managing-a-batch-pending-from-processing" title="Permalink to this headline">¶</a></h3>
<p><strong>When a batch is pending from processing, this means it is approved but has not been handled by the application, this can happen for various reasons:</strong></p>
<ul class="simple">
<li><p>Right after the initial validation, it can take a few minutes before the messages will start to be processed</p></li>
<li><p>Due to technical issues, if the Heavy Forwarders responsible the consumption of these messages are not currently available, or cannot access the Splunk infrastructure properly</p></li>
</ul>
<p><strong>A user with the relevant permissions can decide to cancel the job via the UI, as it is already approved this function is disabled automatically:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches7.png"><img alt="manage_batches7.png" class="align-center" src="_images/manage_batches7.png" style="width: 1200px;" /></a>
</div>
<div class="section" id="managing-a-batch-pending-in-temporary-failure">
<h3>Managing a batch pending in temporary failure<a class="headerlink" href="#managing-a-batch-pending-in-temporary-failure" title="Permalink to this headline">¶</a></h3>
<p><strong>When a batch is in temporary failure, this means that we already attempted at least once to send the messages to MQ, but the operation has failed at least once:</strong></p>
<ul class="simple">
<li><p>A policy defined on the SHC says how many attempts will be processed for the same messages (default to 10 attempts)</p></li>
<li><p>When the maximal number of attempts for a given message has been reached, the status moves automatically to permanent failure</p></li>
<li><p>The manage batch UI show up with the latest error encountered while trying to send to MQ</p></li>
</ul>
<a class="reference internal image-reference" href="_images/manage_batches8.png"><img alt="manage_batches8.png" class="align-center" src="_images/manage_batches8.png" style="width: 1200px;" /></a>
<p><strong>The Overview user interface will show as well the activity of the failing messages:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches9.png"><img alt="manage_batches9.png" class="align-center" src="_images/manage_batches9.png" style="width: 1200px;" /></a>
<p><strong>When a batch is in temporary failure, the manage batch UI allows the submitter to cancel the batch is necessary: (only users with the application submitter roles, or the super admin, can cancel a running job)</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches10.png"><img alt="manage_batches10.png" class="align-center" src="_images/manage_batches10.png" style="width: 1200px;" /></a>
</div>
<div class="section" id="managing-a-batch-pending-in-permanent-failure">
<h3>Managing a batch pending in permanent failure<a class="headerlink" href="#managing-a-batch-pending-in-permanent-failure" title="Permalink to this headline">¶</a></h3>
<p><strong>When a batch of messages has reached the maximal number of attempts defined by the application policy, the status moves from temporary_failure to permanent_failure:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches11.png"><img alt="manage_batches11.png" class="align-center" src="_images/manage_batches11.png" style="width: 1200px;" /></a>
<p><strong>At this stage, the batch can no longer be canceled as it was already by the system, and the manage batch UI would show the following message if user with approval roles tries to manage it:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches12.png"><img alt="manage_batches12.png" class="align-center" src="_images/manage_batches12.png" style="width: 1200px;" /></a>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The records will remain in the KVstore for a certain of time which is defined by the retention policy, when this period is over, records are permanently purged</p>
</div>
</div>
<div class="section" id="managing-a-successful-batch">
<h3>Managing a successful batch<a class="headerlink" href="#managing-a-successful-batch" title="Permalink to this headline">¶</a></h3>
<p><strong>When a batch of messages was successfully sent to MQ, the batch appears as successful in the manage batch UI:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches13.png"><img alt="manage_batches13.png" class="align-center" src="_images/manage_batches13.png" style="width: 1200px;" /></a>
<p><strong>At this stage, the manage cannot be managed any longer as it has been processed already, the UI would show an informational message when accessing to it:</strong></p>
<a class="reference internal image-reference" href="_images/manage_batches14.png"><img alt="manage_batches14.png" class="align-center" src="_images/manage_batches14.png" style="width: 1200px;" /></a>
</div>
</div>
<div class="section" id="verifying-the-status-of-the-mq-submission">
<h2>Verifying the status of the MQ submission<a class="headerlink" href="#verifying-the-status-of-the-mq-submission" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mq-overview-dashboard">
<h3>MQ Overview dashboard<a class="headerlink" href="#mq-overview-dashboard" title="Permalink to this headline">¶</a></h3>
<p><strong>Splunk administrators, MQ submitters and approvers can rely on the MQ Overview dashboard to verify the activity of the MQ resubmission solution:</strong></p>
<a class="reference internal image-reference" href="_images/verify_status1.png"><img alt="verify_status1.png" class="align-center" src="_images/verify_status1.png" style="width: 1200px;" /></a>
<p><strong>Depending on the user status, you will:</strong></p>
<ul class="simple">
<li><p>See all applications and all messages if you are an administrator, or a member of the MQ super admin role</p></li>
<li><p>See all applications and messages for the list of applications you are a member of</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="troubleshoot.html" class="btn btn-neutral float-right" title="Troubleshoot" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="rbac.html" class="btn btn-neutral float-left" title="Role Based Access Control (RBAC)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, DHL.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>